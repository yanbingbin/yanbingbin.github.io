## 网页加载流程

### URL解析

解析 `URL` 提取出协议、域名、端口号，对于一些特殊字符，在传递的时候需要进行编码解码。
- `encodeURI`、`decodeURI`可以对中文、空格等编码解码，适用于 `URL` 本身
- `encodeURIComponent`、`decodeURIComponent`范围更广，会编码解码一些特殊字符如 `:/?=+@#$`,适用于给参数编码解码

### 缓存检查

依次查找 `Memory Cache`、`Disk Cache`中是否有缓存内容，有且没过期则使用，否则则发送网络请求。

### DNS 解析

> 什么是 `DNS` 解析，每台计算机的唯一标识是 `IP` 地址，但是 `IP` 地址不方便记忆，所以采用更方便记忆的网址去查找其他计算机，将网址转换成 `IP` 地址的过程就是 `DNS` 解析。

域名解析是一个递归查询的过程。
1. 浏览器缓存，向浏览器的缓存中读取上一次的访问记录
2. 操作系统的缓存，查找存储在系统运行内存中的缓存
3. 在 `host` 文件中查找
4. 路由器缓存：有些路由器会把访问过的域名存在路由器上
5. `ISP`互联网服务提供商缓存，比如 `114.114.114.114`，
6. 缓存中找不到，则进行迭代查询：`.` 根 `DNS` 服务器 -> `.com` 顶级服务器 -> 主域名服务器 -> ...，直到服务器返回对应的 `IP`

`DNS` 负载均衡：
> 网站对应的 `IP` 不止一个，`DNS` 可以根据每台机器的负载量、距离用户的距离等返回一个合适的服务器 `IP` 给用户，这个过程就是 `DNS` 负载均衡，又叫做 `DNS` 重定向。 `CDN` 就是利用 `DNS` 的重定向技术， `DNS` 会返回一个用户最接近的点的 `IP` 给用户。

优化： `DNS` 预解析, 通过 `dns-prefetch` 属性提前进行 `DNS` 解析。

```js
<link rel="dns-prefetch" href="//g.alicdn.com" />  
```

### TCP 连接

拿到 `IP` 后，(检查当前域名是否达到 `TCP` 连接上限)，通过三次握手进行 `TCP` 连接

三次握手抽象版：
1. 客户端：hello，你是server么？
2. 服务端：hello，我是server，你是client么
3. 客户端：yes，我是client


![](https://user-gold-cdn.xitu.io/2020/2/23/170723de9b8aa08b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

三次握手：
1. 第一次：客户端发送 `SYN = 1` 和确认号 `seq = 随机值x`  给服务端，此时客户端状态为 `SYN-SENT`
2. 第二次：服务端收到包后，将标识位 `SYN` 和 `ACK` 置为1, `seq = 随机值y, ack = x + 1`发送给客户端，此时服务端状态为 `SYN-RECEIVED`
3. 第三次：客户端收到后，状态切换为 `ESTABLISHED`，将标识位 `ACK` 置为1，`seq = x + 1, ack = y + 1`发送给服务端，服务端收到后也将状态切换为 `ESTABLISHED`

为什么不能两次握手：两次握手，服务器不能确定客户端已经收到了确认请求，不能确认是否建立好了连接。服务器认为建立好了连接，发送数据包，结果发的包客户端没收到，那么攻击服务器就很容易了，只发包不收包。

`TCP` 和 `UDP` 的区别：
- `TCP` 是一个面向连接的、可靠的、基于字节流的传输层协议，`TCP` 会精准记录哪些数据发送了，哪些数据被对方接收了，哪些没有被接收到，而且保证数据包按序到达，不允许半点差错。这是`有状态`, 当意识到丢包了或者网络环境不佳，`TCP` 会根据具体情况调整自己的行为，控制自己的发送速度或者重发。这是`可控制`。
- `UDP` 是一个面向无连接的传输层协议，`无状态`、`不可控`。


## 参考文章

- ![阿里面试官的”说一下从url输入到返回请求的过程“问的难度就是不一样！](https://juejin.cn/post/6928677404332425223)
- ![从输入URL到页面加载的过程？如何由一道题完善自己的前端知识体系！](https://dailc.github.io/2018/03/12/whenyouenteraurl.html)
- ![(建议收藏)TCP协议灵魂之问，巩固你的网路底层基础](https://juejin.cn/post/6844904070889603085#heading-1)